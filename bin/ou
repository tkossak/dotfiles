#!/usr/bin/env python3

# unquote link and open it in new tab

import webbrowser
import urllib.parse
import argparse
import pyperclip

# parser = argparse.ArgumentParser('extract udemy coupon link, unescape and open in new tab')
parser = argparse.ArgumentParser()
# parser.add_argument('-u', '--udemy', help='the given link is direct link to udemy'
#                                    , action='store_true')
parser.add_argument('url', nargs='?')
args = parser.parse_args()

if args.url == None:
    args.url = pyperclip.paste()


s = urllib.parse.parse_qs(args.url)
for i in s.values():
    i = i[0]
    if i.startswith('https://www.udemy'):
        print('Starting url: {}'.format(i))
        webbrowser.open_new_tab(i)
        break
else:
    print('No url found.')
