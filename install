#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset
# set -o xtrace

# magic variables for links
__sfile="$(readlink -f ${BASH_SOURCE[0]})"
__sdir="$(cd "$(dirname "${__sfile}")" && pwd)"

# --------------------------------------------------------------------------------
source ${__sdir}/install.source

print_help()
{
    echo "CLI options:"
    echo "  -l  :: break links"
    echo "  -d  :: install dotfiles"
    echo "  -b  :: install dotfiles + basics 1"
    echo "  -a  :: install dotfiles + basics 1 + 2"
    echo "  -A  :: install dotfiles + basics 1 + 2 + 3 (new comp)"
    return 0
}

if [[ $# = 0 ]]; then
    print_help
    exit 0
fi

ltype="---"
if_dotfiles="N"
if_basics1="N"
if_basics2="N"
if_basics3_new_comp="N"
if_break_links="N"
if_testing="N"


[[ $# = 0 ]] && if_dotfiles="Y"

while [[ $# > 0 ]]; do
    case "$1" in
        -h|--help)
            print_help
            exit 0
            ;;
        -l)
            shift
            if_break_links="Y"
            ;;
        -d)
            shift
            if_dotfiles="Y"
            ;;
        -b)
            shift
            if_break_links="Y"
            if_basics1="Y"
            if_dotfiles="Y"
            ;;
        -a)
            shift
            if_break_links="Y"
            if_basics1="Y"
            if_basics2="Y"
            if_dotfiles="Y"
            ;;
        -A)
            shift
            if_break_links="Y"
            if_basics1="Y"
            if_basics2="Y"
            if_basics3_new_comp="Y"
            if_dotfiles="Y"
            ;;
        -t)
            if_testing="Y"
            shift
            ;;
        *)
            loguj -e -t "${ltype}" "Unknown option: $1"
            print_help
            exit 1
            ;;
    esac
done

# ================================================================================
# print environment
echo "=== ENVIRONMENT ============================================"
echo "__sdir=${__sdir}"
if [[ -d "${__dir_dlocal}" ]]; then
    echo "__dir_dlocal (exists) =${__dir_dlocal}"
else
    echo "__dir_dlocal (NOT exists) =${__dir_dlocal}"
fi
echo "__myos=${__myos}"
echo "__myhost=${__myhost}"
if [[ -d "${__win_appdata}" ]]; then
    echo "__win_appdata (exists) =${__win_appdata}"
else
    echo "__win_appdata (NOT exists) =${__win_appdata}"
fi

# ================================================================================
# Initial cmds:

mkdir -p ${HOME}/apps
mkdir -p ${HOME}/.emacs.d/mine
# mkdir -p ~/.emacs.d/evil
[[ -d ${__win_appdata} ]] &&
    mkdir -p ${__win_appdata}/.emacs.d/mine
find ${__sdir}/bin -type f -exec chmod u+x {} \;
[[ -e "${__sdir}/bin/create_bash.model" ]] && chmod -x "${__sdir}/bin/create_bash.model"

find ${__sdir} -maxdepth 1 -type f -exec chmod -x {} \;
[[ -e "${__sdir}/install" ]] && chmod u+x "${__sdir}/install"
[[ -e "${__sdir}/i_git" ]] && chmod u+x "${__sdir}/i_git"


# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# break_links()
break_links()
{
    local ltype="BRK"
    local src
    loguj -ss -t "${ltype}" "BREAKING LINKS"
    for link in ~/.tmux.conf ~/.vimrc ~/.vimrc.local ~/.vimrc.plugins ~/.bashrc ~/.bashrc.local ~/.emacs ~/.emacs.d/mine/.emacs.local ~/.gitconfig ~/.gitconfig.local \
        ~/.weechat/guile ~/.weechat/javascript ~/.weechat/lua ~/.weechat/perl ~/.weechat/python ~/.weechat/ruby ~/.weechat/script ~/.weechat/tcl ~/.weechat/xfer ~/.weechat/alias.conf ~/.weechat/aspell.conf ~/.weechat/buffers.conf ~/.weechat/charset.conf ~/.weechat/exec.conf ~/.weechat/irc.conf ~/.weechat/iset.conf ~/.weechat/logger.conf ~/.weechat/plugins.conf ~/.weechat/relay.conf ~/.weechat/script.conf ~/.weechat/sec.conf ~/.weechat/trigger.conf ~/.weechat/weechat.conf ~/.weechat/xfer.conf \
        ~/.config/ranger/rc.conf ~/.config/ranger/rifle.conf ~/.mplayer/config ~/.mplayer/input.conf ~/.gconf/apps/gnome-terminal ~/.config/vlc/vlcrc
    do
        if [[ -e "${link}" ]]; then
            src="$(readlink -f ${link})"
        else
            src=""
            loguj -i -t "${ltype}" "Dst file does not exist: ${link}"
            continue
        fi

        if [[ ! -L "${link}" ]]; then
           loguj -i -t "${ltype}" "Not a link: ${link}"
        elif [[ -n "${src}" && ! -r ${src} ]]; then
            loguj -e -t "${ltype}" "Src file is not readable! (${src})"
        elif [[ -L "$link" ]]; then
            rm -rf "${link}"
            cp -r "${src}" ${link}
            loguj -i -t "${ltype}" "UNLINKED: ${link}"
        else
            loguj -e -t "${ltype}" "Unknown case"
        fi
    done
    loguj -se -t "${ltype}" "BREAKING LINKS"
    return 0
}


# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# install_dotfiles
install_dotfiles()
{
    local ltype="DOT"
    loguj -ss -t "${ltype}" "DOTFILES"

    # Folders:
    create_link ${__sdir} ~/.dotfiles
    create_link ${__dir_dlocal} ~/.dotfiles.local || true
    find ${__dir_dlocal} -maxdepth 1 -type f -exec chmod -x {} \; || true

    # TMUX
    create_link ${__sdir}/tmux.conf ~/.tmux.conf || true

    # Git
    create_link ${__sdir}/gitconfig ~/.gitconfig || true
    create_link ${__dir_dlocal}/gitconfig.local ~/.gitconfig.local || true

    # Bash:
    create_link ${__sdir}/bashrc ~/.bashrc || true
    create_link ${__dir_dlocal}/bashrc.local ~/.bashrc.local || true

    # Vim
    create_link ${__sdir}/vimrc ~/.vimrc || true
    create_link ${__sdir}/vimrc.plugins ~/.vimrc.plugins || true
    create_link ${__dir_dlocal}/vimrc.local ~/.vimrc.local || true

    # gnome-terminal
    if [[ -d ~/.gconf/apps/gnome-terminal ]]; then
        create_link ${__sdir}/gnome-terminal ~/.gconf/apps/gnome-terminal || true
    fi

    # Emacs Linux:
    if hash emacs 2>/dev/null; then
        create_link ${__sdir}/emacs ~/.emacs || true
        create_link ${__dir_dlocal}/emacs.local ~/.emacs.d/mine/.emacs.local || true
    fi

    # Emacs Win:
    if [[ -f ${__win_appdata} ]]; then
        loguj -p -i -t "${ltype}" "Linking windows emacs links in ${__win_appdata}"
        create_link -w ${__sdir}/emacs ${__win_appdata}/.emacs || true
        create_link -w ${__dir_dlocal}/emacs.local ${__win_appdata}/.emacs.d/mine/.emacs.local || true
        # evil-leader:
        create_link -w ~/.emacs.d/mine/evil-leader.el ${__win_appdata}/.emacs.d/mine/evil-leader.el || true
        # key-chord:
        create_link -w ~/.emacs.d/mine/key-chord.el ${__win_appdata}/.emacs.d/mine/key-chord.el || true
        # evil:
        create_link -w ~/.emacs.d/evil ${__win_appdata}/.emacs.d/evil || true
        # org-mode:
        create_link -w ~/.emacs.d/org-mode ${__win_appdata}/.emacs.d/org-mode || true
    fi

    # if [[ -d ${__dir_dlocal} ]]; then
    #     # create_link ${__dir_dlocal} ~/.dotfiles.local || true
    #     # create_link ${__dir_dlocal}/bashrc.local ~/.bashrc.local || true
    #     # create_link ${__dir_dlocal}/vimrc.local ~/.vimrc.local || true
    #     # create_link ${__dir_dlocal}/gitconfig.local ~/.gitconfig.local || true
    #     # create_link ${__dir_dlocal}/emacs.local ~/.emacs.d/mine/.emacs.local || true
    #     # [[ -d "${__win_appdata}" ]] && create_link -w ${__dir_dlocal}/emacs.local ${__win_appdata}/.emacs.d/mine/.emacs.local || true
    # else
    #     loguj -i -t "${ltype}" "Emacs: no local dir."
    # fi

    #Ranger:
    # if hash ranger 2>/dev/null; then
    #     sed -i 's/^set column_ratios 1,5,3$/set column_ratios 1,3,4' ~/.config/ranger/rc.conf
    # fi
    if hash ranger 2>/dev/null; then
        find ~/.config/ranger -type f -not -name 'bookmarks' -not -name 'history' -not -name 'tagged' -exec rm -rf {} \;
        ranger --copy-config=all
        # replace rc.conf:
        sed -i 's/^set column_ratios 1,3,4$/set column_ratios 1,5,3/;
        s/^set show_hidden false$/set show_hidden true/;
        s/^set preview_files true$/set preview_files false/
        s/^set preview_files true$/set preview_files false/
        s/^set preview_directories true$/set preview_directories false/' ~/.config/ranger/rc.conf

        # replace rifle.conf:
        sed -i 's/mime \^video,       has mplayer,  X, flag f = mplayer -- "$@"/mime ^video,       has mplayer,  X, flag f = mplayer -fs -softvol -softvol-max 300 -- "$@"/' ~/.config/ranger/rifle.conf

        if [[ -d "${__dir_dlocal}" ]]; then
            case ${__myos} in
                CYGWIN)
                    if [[ ${__myhost} = W ]]; then
                        # create_link ~/.dotfiles.local/rifle.conf.w.cygwin ~/.config/ranger/rifle.conf
                        cat ~/.config/ranger/rifle.conf ${__dir_dlocal}/rifle.conf.w.cygwin > ~/.config/ranger/rifletmp.conf
                        mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                        loguj -i -t "${ltype}" "CP: rifle.conf (C-W)"
                    elif [[ ${__myhost} = H ]]; then
                        # create_link ~/.dotfiles.local/rifle.conf.h.cygwin ~/.config/ranger/rifle.conf
                        cat ~/.config/ranger/rifle.conf ${__dir_dlocal}/rifle.conf.h.cygwin > ~/.config/ranger/rifletmp.conf
                        mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                        loguj -i -t "${ltype}" "CP: rifle.conf (C-H)"
                    else
                        # loguj -i -t "${ltype}" "Ranger - cygwin - unknown host Copying default file."
                        cat ~/.config/ranger/rifle.conf ${__sdir}/rifle.conf > ~/.config/ranger/rifletmp.conf
                        mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                        loguj -i -t "${ltype}" "CP: rifle.conf (C-OTHER)"
                    fi
                    ;;
                LINUX)
                    if [[ ${__myhost} = H ]]; then
                        # create_link ~/.dotfiles.local/rifle.conf.h.linux ~/.config/ranger/rifle.conf
                        cat ~/.config/ranger/rifle.conf ${__dir_dlocal}/rifle.conf.h.linux > ~/.config/ranger/rifletmp.conf
                        mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                        loguj -i -t "${ltype}" "CP: rifle.conf (L-H)"
                    else
                        loguj -i -t "${ltype}" "Ranger - linux - unknown host Copying default file."
                        cat ~/.config/ranger/rifle.conf ${__sdir}/rifle.conf > ~/.config/ranger/rifletmp.conf
                        mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                        loguj -i -t "${ltype}" "CP: rifle.conf (L-OTHER)"
                    fi
                    ;;
                *)
                    cat ~/.config/ranger/rifle.conf ${__sdir}/rifle.conf > ~/.config/ranger/rifletmp.conf
                    mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
                    loguj -i -t "${ltype}" "CP: rifle.conf (OTHER-OTHER)"
                    ;;
            esac
        else
            cat ~/.config/ranger/rifle.conf ${__sdir}/rifle.conf > ~/.config/ranger/rifletmp.conf
            mv ~/.config/ranger/rifletmp.conf ~/.config/ranger/rifle.conf
            # loguj -i -t "${ltype}" "Ranger - no local dotfiles. Copying default file."
            loguj -i -t "${ltype}" "CP: rifle.conf (default - no local dotfiles)"
        fi
        # if [[ "${__myos}" == "LINUX" ]]; then
        ${__sudo} chown ${__my_user} ~/.config/ranger/bookmarks
        # fi
    else
        loguj -i -t "${ltype}" "Ranger not found. Not creating links."
    fi

    # mplayer
    if hash mplayer 2>/dev/null || [[ -d ~/.mplayer ]]; then
        create_link ${__sdir}/mplayer_config ~/.mplayer/config || true
        create_link ${__sdir}/mplayer_input.conf ~/.mplayer/input.conf || true
    fi

    # weechat
    if ( hash weechat 2>/dev/null || [[ -d ~/.weechat ]] ) && [[ -d ${__dir_dlocal} ]]; then
        if [[ -d ${__dir_dlocal}/weechat ]]; then
           create_link ${__dir_dlocal}/weechat/guile ~/.weechat/guile || true
           create_link ${__dir_dlocal}/weechat/javascript ~/.weechat/javascript || true
           create_link ${__dir_dlocal}/weechat/lua ~/.weechat/lua || true
           create_link ${__dir_dlocal}/weechat/perl ~/.weechat/perl || true
           create_link ${__dir_dlocal}/weechat/python ~/.weechat/python || true
           create_link ${__dir_dlocal}/weechat/ruby ~/.weechat/ruby || true
           create_link ${__dir_dlocal}/weechat/script ~/.weechat/script || true
           create_link ${__dir_dlocal}/weechat/tcl ~/.weechat/tcl || true
           create_link ${__dir_dlocal}/weechat/xfer ~/.weechat/xfer || true
           create_link ${__dir_dlocal}/weechat/alias.conf ~/.weechat/alias.conf || true
           create_link ${__dir_dlocal}/weechat/aspell.conf ~/.weechat/aspell.conf || true
           create_link ${__dir_dlocal}/weechat/buffers.conf ~/.weechat/buffers.conf || true
           create_link ${__dir_dlocal}/weechat/charset.conf ~/.weechat/charset.conf || true
           create_link ${__dir_dlocal}/weechat/exec.conf ~/.weechat/exec.conf || true
           create_link ${__dir_dlocal}/weechat/irc.conf ~/.weechat/irc.conf || true
           create_link ${__dir_dlocal}/weechat/iset.conf ~/.weechat/iset.conf || true
           create_link ${__dir_dlocal}/weechat/logger.conf ~/.weechat/logger.conf || true
           create_link ${__dir_dlocal}/weechat/plugins.conf ~/.weechat/plugins.conf || true
           create_link ${__dir_dlocal}/weechat/relay.conf ~/.weechat/relay.conf || true
           create_link ${__dir_dlocal}/weechat/script.conf ~/.weechat/script.conf || true
           create_link ${__dir_dlocal}/weechat/sec.conf ~/.weechat/sec.conf || true
           create_link ${__dir_dlocal}/weechat/trigger.conf ~/.weechat/trigger.conf || true
           create_link ${__dir_dlocal}/weechat/weechat.conf ~/.weechat/weechat.conf || true
           create_link ${__dir_dlocal}/weechat/xfer.conf ~/.weechat/xfer.conf || true

        else
            loguj -i -t "${ltype}" "No weechat local dotfiles."
        fi
    fi

    # vlc
    if [[ -f "${__dir_dlocal}/vlcrc" ]]; then
        create_link "${__dir_dlocal}/vlcrc" "${HOME}/.config/vlc/vlcrc"
    fi

    # vim +PluginInstall +PluginClean +qall
    vim +PlugInstall +PlugClean +qall

    loguj -se -t "${ltype}" "DOTFILES"
    return 0
}


# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
install_apps_basic3_new_comp()
{

    local ltype="BA3"
    loguj -ss -t "${ltype}" "BASICS 3"

    # Emacs
    aptget emacs || true
    if hash emacs 2>/dev/null; then
        # evil-leader:
        geturl https://raw.githubusercontent.com/cofi/evil-leader/master/evil-leader.el ~/.emacs.d/mine/evil-leader.el -sha1 00c336e55307dbcb3f73f47b1d9a1d759404341d || true
        # key-chord:
        geturl http://www.emacswiki.org/emacs/download/key-chord.el ~/.emacs.d/mine/key-chord.el -sha1 2da61bf970ca332c4de96c1977fc7e326df6c33a || true
        # evil:
        gitclone https://gitorious.org/evil/evil.git ~/.emacs.d/evil \
            ||
            {
                loguj -i -t "${ltype}" "Manually downloading evil.git"
                rm -rf ~/.emacs.d/evil
                rm -rf ~/.emacs.d/lyro-evil*
                cd ~/.emacs.d
                if [[ ! -f evil-default.zip ]]; then
                    ${__geturl_app} evil-default.zip https://bitbucket.org/lyro/evil/get/default.zip \
                        ||
                        {
                            loguj -e -t "${ltype}" "Downloading evil.git (default.zip)"
                        } \
                        &&
                        {
                            unzip evil-default.zip
                            mv ~/.emacs.d/lyro-evil* evil
                            rm ~/.emacs.d/evil-default.zip
                            loguj -d -t "${ltype}" "evil"
                            loguj -e -t "${ltype}" "Evil downloaded manually."
                        }
                fi
            }
        # org-mode:
        gitclone git://orgmode.org/org-mode.git ~/.emacs.d/org-mode "git checkout -b stable origin/maint" "git pull" "make autoloads" || true
    fi

    # geeknote
    gitclone https://github.com/VitaliyRodnenko/geeknote.git ~/apps/geeknote "${__sudo} python setup.py install" "geeknote settings --editor vim" || true

    # BeautifulSoup4
    pipinstall -3 BeautifulSoup4 || true

    # flake8
    pipinstall -3 flake8 || true

    # bashate
    pipinstall -3 bashate || true

    # httpie
    pipinstall httpie || true

    # different
    aptget -ol vlc
    aptget -ol mplayer
    aptget -ol krdc
    aptget -ol vpnc
    aptget -ol openvpn
    aptget -ol dos2unix

    # geeknote login....?
    loguj -se -t "${ltype}" "BASICS 3"
    return 0
}


# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# install_apps_basics2
install_apps_basics2()
{

    local ltype="BA2"
    loguj -ss -t "${ltype}" "BASICS 2"

    # commacd
    geturl https://raw.githubusercontent.com/shyiko/commacd/master/commacd.bash ~/.commacd.bash || true

    # glances
    aptget -ol glances \
        &&
        {
            aptget lm-sensors || true
            pipinstall -2 -H PySensors || true
        } || true

    # speedtest-cli
    pipinstall -2 speedtest-cli || true

    # fzf - asks questions
    if [[ ! -d ~/.fzf ]]; then
        git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf && ~/.fzf/install || true
    fi

    # geeknote login
    loguj -se -t "${ltype}" "BASICS 2"
    return 0
}

# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# install_apps_basic
install_apps_basic()
{

    local ltype="BA1"
    local tmp_options
    loguj -ss -t "${ltype}" "BASICS 1"

    # update repositories
    # if hash apt-get 2>/dev/null; then
    #     ${__sudo} apt-get update
    # fi

    # curl
    aptget curl && __geturl_app="curl -o" || true

    # wget
    aptget wget && __geturl_app="wget -O" || true

    # git
    aptget git || true

    # vim
    aptget vim || true
        # del Vundle:
        if [[ -d ~/.vim/bundle/Vundle.vim ]]; then
            loguj -i -t "${ltype}" "Old Vundle present - deleting whole ~/.vim"
            rm -rf ~/.vim
        fi
        # install Plug:
        if [[ ! -e ~/.vim/autoload/plug.vim ]]; then
            curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
                https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim \
            && loguj -s -t "${ltype}" "Vim plugin 'Plug' installed" \
            || loguj -e -t "${ltype}" "Vim plugin 'Plug' NOT installed"
        fi

    # make
    aptget make || true

    # vim-vundle
    # gitclone https://github.com/gmarik/Vundle.vim.git ~/.vim/bundle/Vundle.vim || true

    # PIP2
    local if_getpip_downloaded="0"
    local cur_pip_verson="7.1.0"
    local cur_pip_sha1="89eb61fc5b59f14df7f0aa7b020afb5a6ded2e14"
    local installer="/tmp/get-pip.py"
    local cur_python_cmd="python2"
    local cur_pip_cmd="pip2"
    local ver=""

    # check czy juz istnieje:
    if [[ -e "${installer}" ]]; then
        if checksum "${installer}" -sha1 "${cur_pip_sha1}"; then
            if_getpip_downloaded=1
        else
            rm -rf "${installer}"
        fi
    fi

    if hash ${cur_python_cmd} 2>/dev/null; then
        hash ${cur_pip_cmd} 2>/dev/null \
            && ver="$(${cur_pip_cmd} --version | sed 's/ /\n/g' | sed -n '2p')" \
            || ver="no ${cur_pip_cmd}"

        if [[ "${ver}" != "${cur_pip_verson}" ]]; then
            # download
            loguj -i -t "${ltype}" "Current ${cur_pip_cmd} version: ${ver}. Installing."
            if [[ "${if_getpip_downloaded}" = "0" ]]; then
                geturl https://bootstrap.pypa.io/get-pip.py "${installer}" -sha1 "${cur_pip_sha1}" \
                    && if_getpip_downloaded="1"
            fi

            # install
            if [[ "${if_getpip_downloaded}" = "1" ]]; then
                [[ -n "${__sudo}" ]] && tmp_options="-H" || tmp_options=""
                ${__sudo} ${tmp_options} ${cur_python_cmd} "${installer}" \
                    && loguj -s -t "${ltype}" "${cur_pip_cmd}" \
                    || loguj -e -t "${ltype}" "Problem instalilng ${cur_pip_cmd}"
            else
                loguj -e -t "${ltype}" "Problem downloading ${cur_pip_cmd}"
            fi
        else
            loguj -i -t "${ltype}" "${cur_pip_cmd} is already up to date (${ver})"
        fi
    fi

    # PIP3
    cur_python_cmd="python3"
    cur_pip_cmd="pip3"
    if hash ${cur_python_cmd} 2>/dev/null; then
        hash ${cur_pip_cmd} 2>/dev/null \
            && ver="$(${cur_pip_cmd} --version | sed 's/ /\n/g' | sed -n '2p')" \
            || ver="no ${cur_pip_cmd}"

        if [[ "${ver}" != "${cur_pip_verson}" ]]; then
            # download
            loguj -i -t "${ltype}" "Current ${cur_pip_cmd} version: ${ver}. Installing."
            if [[ "${if_getpip_downloaded}" = "0" ]]; then
                geturl https://bootstrap.pypa.io/get-pip.py "${installer}" -sha1 "${cur_pip_sha1}" \
                    && if_getpip_downloaded="1"
            fi

            # install
            if [[ "${if_getpip_downloaded}" = "1" ]]; then
                [[ -n "${__sudo}" ]] && tmp_options="-H" || tmp_options=""
                ${__sudo} ${tmp_options} ${cur_python_cmd} "${installer}" \
                    && loguj -s -t "${ltype}" "${cur_pip_cmd}" \
                    || loguj -e -t "${ltype}" "Problem instalilng ${cur_pip_cmd}"
            else
                loguj -e -t "${ltype}" "Problem downloading ${cur_pip_cmd}"
            fi
        else
            loguj -i -t "${ltype}" "${cur_pip_cmd} is already up to date (${ver})"
        fi
    fi

    # [[ "${if_getpip_downloaded}" = "1" ]] && rm -rf "${installer}"

    # Ranger
    # rm -rf ~/apps/ranger ~/.config/ranger
    gitclone https://github.com/hut/ranger.git ~/apps/ranger "${__sudo} make install" "ranger --copy-config=all" || true

    # TMUX
    aptget tmux || true

    # dtrx
    if ! hash dtrx 2>/dev/null; then
        rm -rf /tmp/dtrx-7.1
        geturl -d http://brettcsmith.org/2007/dtrx/dtrx-7.1.tar.gz /tmp/dtrx-7.1.tar.gz -sha1 05cfe705a04a8b84571b0a5647cd2648720791a4 "tar -xf dtrx-7.1.tar.gz" "cd dtrx-7.1" "${__sudo} python setup.py install --prefix=/usr/local" "rm -rf /tmp/dtrx-7.1" "rm -rf /tmp/dtrx-7.1.tar.gz" || true
    fi
    # aptget dtrx ||
    #     {
    #         rm -rf /tmp/dtrx-7.1
    #         geturl -d http://brettcsmith.org/2007/dtrx/dtrx-7.1.tar.gz /tmp/dtrx-7.1.tar.gz -sha1 05cfe705a04a8b84571b0a5647cd2648720791a4 "tar -xf dtrx-7.1.tar.gz" "cd dtrx-7.1" "${__sudo} python setup.py install --prefix=/usr/local" "rm -rf /tmp/dtrx-7.1" "rm -rf /tmp/dtrx-7.1.tar.gz" || true
    #     }

    # fasd
    gitclone https://github.com/clvv/fasd.git ~/apps/fasd "${__sudo} make install" || true

    loguj -se -t "${ltype}" "BASICS 1"
    return 0
}


# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------

testing()
{
    echo "=== TESTING START =================================================="
    echo "install git test"

    local cur_git_ver="2.5.0"
    sudo apt-get install git libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev

    cd ${HOME}/apps
    git clone git://git.kernel.org/pub/scm/git/git.git
    cd ${HOME}/apps/git

    sudo apt-get install asciidoc xsltproc docbook2X xmlto
    make prefix=/usr all doc info
    # ... lasted in vb: 14 min

    sudo make prefix=/usr install install-doc install-html install-info
    # ... lasted in vb: 12s

    echo "=== TESTING END ===================================================="
    return 0
}

# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# --------------------------------------------------------------------------------

[[ ${if_break_links} == "Y" ]] && break_links

# update repos?
if [[ "${if_basics1}" == "Y" || "${if_basics2}" == "Y" || "${if_basics3_new_comp}" == "Y" ]]; then
    update_repos
fi

[[ ${if_testing} == "Y" ]] && testing
[[ ${if_basics1} == "Y" ]] && install_apps_basic
[[ ${if_basics2} == "Y" ]] && install_apps_basics2
[[ ${if_basics3_new_comp} == "Y" ]] && install_apps_basic3_new_comp
[[ ${if_dotfiles} == "Y" ]] && install_dotfiles

display_log_info
display_log_error

exit
